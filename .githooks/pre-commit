#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SwiftFormat –∏ SwiftLint
command -v swiftformat >/dev/null 2>&1 || { echo >&2 "error: SwiftFormat not installed. Please run: brew install swiftformat"; exit 1; }
command -v swiftlint >/dev/null 2>&1 || { echo >&2 "error: SwiftLint not installed. Please run: brew install swiftlint"; exit 1; }

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö Swift —Ñ–∞–π–ª–æ–≤
SWIFT_FILES=$(git diff --cached --name-only --diff-filter=d | grep -E '\.(swift)$')

# –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö Swift —Ñ–∞–π–ª–æ–≤, –≤—ã—Ö–æ–¥–∏–º
if [ -z "$SWIFT_FILES" ]; then
    echo "No Swift files to check"
    exit 0
fi

echo "üîç Checking Swift files..."

# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é SwiftFormat
echo "Running SwiftFormat..."
swiftformat $SWIFT_FILES
if [ $? -ne 0 ]; then
    echo "‚ùå SwiftFormat failed"
    exit 1
fi

# –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –∏–Ω–¥–µ–∫—Å
git add $SWIFT_FILES

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é SwiftLint
echo "Running SwiftLint..."
LINT_RESULT=0
for file in $SWIFT_FILES; do
    swiftlint lint --path "$file"
    if [ $? -ne 0 ]; then
        LINT_RESULT=1
    fi
done

if [ $LINT_RESULT -ne 0 ]; then
    echo "‚ùå SwiftLint found issues"
    exit 1
fi

echo "‚úÖ All checks passed!"
exit 0
